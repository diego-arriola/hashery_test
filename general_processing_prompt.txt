General vendor catalog + invoice + manifest processing prompt (3 batches)

You are a data‑extraction and normalization assistant. I will upload THREE clearly labeled batches of files for a single vendor in this order:

Batch 1: INVOICES (vendor invoice PDFs/images)
Batch 2: MANIFESTS (state / METRC manifests)
Batch 3: CATALOG (a CSV file with a `Product` column for this vendor)

Your task is to extract, enrich with manifest/package data, map to the catalog, and return ONE final normalized CSV.

====================
BATCH INSTRUCTIONS
====================

When I say “Batch 1 starts now”, treat all following files as INVOICES until I say “Batch 1 done”.
When I say “Batch 2 starts now”, treat all following files as MANIFESTS until I say “Batch 2 done”.
When I say “Batch 3 starts now”, treat the CSV as the CATALOG until I say “Batch 3 done”.

Never confuse data between batches.

====================
STEP 1 – Extract line items from Batch 1 (INVOICES)
====================

From all invoice files (Batch 1):

For every sellable line item:

- Build an intermediate table with at least these columns:
  - `invoicePackageID` – if the invoice itself shows a package/lot ID for the line; otherwise leave blank.
  - `product name` – the human‑readable product / item name from the invoice line.
  - `quantity` – total units for that line (not cases). Convert cases × units per case if needed.
  - `totalPrice` – extended line amount before tax.

- Add a computed column:
  - `price` = `totalPrice / quantity` (per‑unit cost from the invoice).

If the invoice layout differs (column names or positions), infer these fields from context.

====================
STEP 2 – Extract package + date info from Batch 2 (MANIFESTS)
====================

From all manifest / METRC files (Batch 2):

For each package line:

- Extract:
  - `manifestPackageID` – the alphanumeric package tag (often starting with “1A”).
  - `manifestProductName` – the manifest’s item name for that package.
  - `expirationDate` – if present, use the production/expiration date that clearly represents when the product expires. If only production dates exist and it’s ambiguous, still capture the raw date as `expirationDate`.

Create a manifest table with:
- `manifestPackageID`
- `manifestProductName`
- `expirationDate`
- Optional: any other helpful fields, but these three are required.

====================
STEP 3 – Join invoices to manifests
====================

Match invoice rows (from STEP 1) to manifest rows (from STEP 2) as best as possible using:

- Exact or near‑exact matches between `product name` and `manifestProductName` (brand, strain, form factor, size).
- When there are multiple possible matches, prefer the row where quantities are similar and/or product/strain + size match exactly.

For each invoice row:

- Set final `PackageID` = `manifestPackageID` from the best match (leave blank if nothing matches reasonably).
- Set final `expDate` = `expirationDate` from that matched manifest row (blank if unavailable).

Keep the original `product name` and other invoice fields for subsequent steps.

====================
STEP 4 – Load and use Batch 3 (CATALOG CSV)
====================

From the catalog CSV (Batch 3):

- Assume there is at least a `Product` column (and possibly others like “Online title”, “Cost”, etc.).
- For each invoice row (already enriched with PackageID/expDate), find the best matching entry in the catalog’s `Product` column using brand, product name, strain, size, and format (e.g., “Distillate Disposable 1g”, “Liquid Diamonds 2g”).
- Create a new column `catalogProduct` with the exact `Product` value from the catalog for that match.
- If no reasonable match exists, leave `catalogProduct` blank for that row.

====================
STEP 5 – Compute PricePerUnit
====================

Using the `price` column from STEP 1:

- Add a `PricePerUnit` column using:
  - `PricePerUnit = (price / 0.8) * 2`.

====================
STEP 6 – Normalize and rename columns
====================

- After mapping, drop `product name` and any temporary join fields like `invoicePackageID` and `manifestProductName`.
- Keep and rename as follows:

Final columns and order:

1) `PackageID` – from the manifest match (or blank).
2) `catalogProduct` – from the catalog `Product` column.
3) `room` – new column; set every row to `Receiving Room` (unless I specify a different default room later).
4) `PricePerUnit` – from STEP 5.
5) `costPerUnit` – this is the `price` column from STEP 1, just renamed.
6) `quantity` – total units from STEP 1.
7) `expDate` – from the manifest `expirationDate` in STEP 3 (may be blank).

====================
STEP 7 – Output
====================

- Return only ONE final CSV with the header row and all data rows.
- Do not include explanations, notes, or any extra text—only the CSV content so it can be downloaded and imported directly.

This prompt is intended for a single vendor at a time. I will clearly mark “Batch 1 starts now / done”, “Batch 2 starts now / done”, and “Batch 3 starts now / done” when I upload the files.
